<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出行秘书 - 路线规划与天气建议</title>
    <link rel="stylesheet" href="style.css">
    <!-- 配置文件 -->
    <script src="config.js"></script>
    <!-- 高德地图API -->
    <script>
        (function() {
            function initMap() {
                // 确保配置已加载
                if (!window.mapConfig || !window.mapConfig.amapKey) {
                    document.getElementById('mapStatus').textContent = '配置加载失败，请检查API密钥设置';
                    return;
                }

                // 加载高德地图API
                const mapScript = document.createElement('script');
                mapScript.src = `https://webapi.amap.com/maps?v=2.0&key=${window.mapConfig.amapKey}&plugin=${window.mapConfig.plugins.join(',')}`;
                mapScript.async = true;

                // 处理加载错误
                mapScript.onerror = () => {
                    document.getElementById('mapStatus').textContent = '地图加载失败，请检查网络连接';
                    console.error('高德地图API加载失败');
                };

                // 确保 API 加载完成后再加载业务代码
                mapScript.onload = () => {
                    const businessScript = document.createElement('script');
                    businessScript.src = 'travel.js';
                    businessScript.onerror = () => console.error('业务代码加载失败');
                    document.head.appendChild(businessScript);
                };

                document.head.appendChild(mapScript);
            }

            // 等待配置加载完成后初始化地图
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initMap);
            } else {
                initMap();
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>出行秘书</h1>
            <p>路线规划与天气建议</p>
        </header>

        <div class="api-status">
            <p>API调用统计：当前 <span id="currentTokens">0</span> 次 / 今日累计 <span id="totalTokens">0</span> 次</p>
            <p id="mapStatus">正在加载地图...</p>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <form id="travelForm" class="travel-form">
                    <div class="form-group">
                        <label for="fromLocation">出发地:</label>
                        <input type="text" id="fromLocation" required placeholder="请输入起点">
                    </div>
                    
                    <div class="form-group">
                        <label for="toLocation">目的地:</label>
                        <input type="text" id="toLocation" required placeholder="请输入终点">
                    </div>
                    
                    <div class="form-group">
                        <label for="travelMode">出行方式:</label>
                        <select id="travelMode">
                            <option value="driving">驾车</option>
                            <option value="transit">公交</option>
                            <option value="walking">步行</option>
                            <option value="bicycling">骑行</option>
                        </select>
                    </div>
                    
                    <button type="submit">规划路线</button>
                </form>

                <div id="weatherInfo" class="weather-info">
                    <h3>天气信息</h3>
                    <p>选择目的地后显示天气信息...</p>
                </div>

                <div id="routeDetails" class="route-details">
                    <h3>路线详情</h3>
                    <p>请先规划路线...</p>
                </div>
            </div>

            <div class="right-panel">
                <div id="mapContainer" class="map-container"></div>
            </div>
        </div>

        <footer>
            <p>注意：API调用次数有限，请合理使用。</p>
        </footer>
    </div>

    <!-- 加载主要功能脚本已在地图API加载完成后动态加载 -->
</body>
</html>